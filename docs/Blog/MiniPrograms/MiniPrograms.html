<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>原生小程序 | 一介书生</title>
    <meta name="description" content="人间熙攘，好久不见">
    <link rel="icon" href="/img/logo.ico">
  <link rel="manifest" href="/manifest.json">
  <link rel="apple-touch-icon" href="/img/logo.png">
    
    <link rel="preload" href="/assets/css/styles.3974c7c8.css" as="style"><link rel="preload" href="/assets/js/app.3974c7c8.js" as="script"><link rel="preload" href="/assets/js/6.58992cca.js" as="script"><link rel="prefetch" href="/assets/js/4.ee6a47b3.js"><link rel="prefetch" href="/assets/css/1.styles.0bd4799b.css"><link rel="prefetch" href="/assets/js/1.0bd4799b.js"><link rel="prefetch" href="/assets/css/2.styles.1dd79bd6.css"><link rel="prefetch" href="/assets/js/2.1dd79bd6.js"><link rel="prefetch" href="/assets/js/3.cb5e462a.js"><link rel="prefetch" href="/assets/js/5.99b8dc59.js"><link rel="prefetch" href="/assets/js/7.4ac236c1.js"><link rel="prefetch" href="/assets/js/8.68f8895b.js"><link rel="prefetch" href="/assets/js/9.59f5ec1f.js"><link rel="prefetch" href="/assets/css/10.styles.8087d254.css"><link rel="prefetch" href="/assets/js/vendors~docsearch.8087d254.js">
    <link rel="stylesheet" href="/assets/css/1.styles.0bd4799b.css"><link rel="stylesheet" href="/assets/css/2.styles.1dd79bd6.css"><link rel="stylesheet" href="/assets/css/styles.3974c7c8.css"><link rel="stylesheet" href="/assets/css/10.styles.8087d254.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">一介书生</span></a> <div class="links" style="max-width:nullpx;"><form id="search-form" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">分类</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Blog/JavaScript/ES6的一些方法和技巧.html" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/Blog/GIT/git的一些总结.html" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/Blog/Node/node版本管理.html" class="nav-link">Node</a></li><li class="dropdown-item"><!----> <a href="/Blog/MiniPrograms/MiniPrograms.html" class="nav-link router-link-exact-active router-link-active">MiniPrograms</a></li></ul></div></div> <a href="https://github.com/magicLaLa/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">分类</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Blog/JavaScript/ES6的一些方法和技巧.html" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/Blog/GIT/git的一些总结.html" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/Blog/Node/node版本管理.html" class="nav-link">Node</a></li><li class="dropdown-item"><!----> <a href="/Blog/MiniPrograms/MiniPrograms.html" class="nav-link router-link-exact-active router-link-active">MiniPrograms</a></li></ul></div></div> <a href="https://github.com/magicLaLa/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Git</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Node</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>MiniPrograms</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/Blog/MiniPrograms/MiniPrograms.html" class="active sidebar-link">原生小程序</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Blog/MiniPrograms/MiniPrograms.html#原生小程序" class="sidebar-link">原生小程序</a></li><li class="sidebar-sub-header"><a href="/Blog/MiniPrograms/MiniPrograms.html#mpvue" class="sidebar-link">MPVUE</a></li></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h2 id="原生小程序"><a href="#原生小程序" aria-hidden="true" class="header-anchor">#</a> 原生小程序</h2> <ul><li>小程序中<code>button</code>组建有默认的点击效果，有<code>border</code>的话，需要去掉边框线的话需要这样写。</li></ul> <div class="language-css extra-class"><pre class="language-css"><code><span class="token comment">/* 去掉button默认边框线 */</span>
<span class="token selector">button::after</span> <span class="token punctuation">{</span>
  <span class="token property">border</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>设置成禁用的话<code>disable=&quot;&quot;</code>,<code>disable</code>为 <code>true</code> 的话，点击按钮的时候还是有默认点击效果，如果需求需要去掉默认点击效果，就需要设置成行内样式来生效。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- 行内样式 --&gt;</span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>get-code<span class="token punctuation">&quot;</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>mini<span class="token punctuation">&quot;</span></span>  <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>getCode<span class="token punctuation">&quot;</span></span> <span class="token attr-name">disabled</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{disabled}}<span class="token punctuation">&quot;</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">color</span><span class="token punctuation">:</span> #00a4ff<span class="token punctuation">;</span> <span class="token property">background-color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{getCodeBtn}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="小程序限制"><a href="#小程序限制" aria-hidden="true" class="header-anchor">#</a> 小程序限制</h3> <ul><li>小程序背景图片不支持相对路径的图片路径，需要设置为绝对路径。</li> <li>小程序现在默认上传包大小为<code>2M</code>（以后有可能变化），可以把图片资源单独打包成一个项目工程，然后在小程序中去引用图片的绝对路径。</li> <li>小程序不支持<code>table</code>组件和标签，如果需要的话可用<code>wxss(css)</code>来写表格，然是涉及到表格跨行跨列的话不太好处理，可以换一种展现格式。简单来说就是小程序不支持复杂的表格。</li> <li>小程序现在支持跳转外部<code>url</code>，需要使用<code>web-view</code>组建来实现，需要在微信公众平台登录，然后在设置里面--&gt;开发设置来绑定业务域名，并且在业务域名的跟目下放微信检验文件，只有放过之后，在域名跟目下能访问到这个检验文件，在绑定业务域名的时候才能绑定成功。</li></ul> <p><img src="/img/%E6%8D%95%E8%8E%B7.PNG" alt="Alt text"></p> <ul><li>小程序使用 <code>wx.request(OBJECT)</code> 来发起请求时，需要在微信公众平台设置--&gt;开发设置里面设置服务器域名配置。</li></ul> <p><img src="/img/fuwuqi.png" alt="Alt text"></p> <ul><li>小程序不能操作BOM/DOM。</li> <li>在 <code>{{}}</code> 模板语法里不持支复杂计算，具体看小程序文档。</li> <li>小程序文字不能上下居中，尤其是在一个些小的按钮里边。</li> <li>小程序 canvas 在真机中不支持base64，画不到canvas里面。</li> <li>小程序获取用户授权之后再能通过 wx.getUserInfo 来获取用户信息，可以通过 button 来发起用户授权。</li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{isLog ? <span class="token punctuation">'</span><span class="token punctuation">'</span> : <span class="token punctuation">'</span>button2<span class="token punctuation">'</span>}}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">open-type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>getUserInfo<span class="token punctuation">&quot;</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>default<span class="token punctuation">&quot;</span></span> <span class="token attr-name">hover-class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>other-button-hover<span class="token punctuation">&quot;</span></span> <span class="token attr-name">bindgetuserinfo</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>login<span class="token punctuation">&quot;</span></span> <span class="token attr-name">disabled</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{loginDisabled}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>用户授权<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="小程序的web-view组件"><a href="#小程序的web-view组件" aria-hidden="true" class="header-anchor">#</a> 小程序的web-view组件</h3> <ul><li><p>在小程序里需要跳转H5页面，需要增加web-view组件，通过 web-view 的 src 属性去跳转，可以在 web-view 页面里的 js 文件里动态的获取赋值。</p></li> <li><p>这个web-view 的 src 链接地址需要在微信公众平台后台 的业务域配置，并且要先在 根域名中放入微信检验文件，可以放多个不同的检验文件。</p></li> <li><p>在 web-view 组件中分享可以通过 options.webViewUrl 来获取 url 来连接。</p></li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 分享获取</span>
<span class="token comment">/**
 * 在分享出去需要携带的 url 上带有多参数的时候需要通过 encodeURIComponent 去编码，否则小程序在分享出去再次获取url 时候会只保留 第一个参数。
*/</span>
<span class="token function">onShareAppMessage</span> <span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>webViewUrl<span class="token punctuation">)</span>
  <span class="token keyword">let</span> path <span class="token operator">=</span> <span class="token string">'/pages/web-view/web-view?url='</span> <span class="token operator">+</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>webViewUrl<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    title<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    path<span class="token punctuation">:</span> path
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token function">onLoad</span> <span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'options.url'</span><span class="token punctuation">,</span> options<span class="token punctuation">.</span>url<span class="token punctuation">)</span>
  <span class="token keyword">let</span> path <span class="token operator">=</span> <span class="token function">decodeURIComponent</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>url<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">,</span> path<span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    path<span class="token punctuation">:</span> path
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="在小程序中的方法"><a href="#在小程序中的方法" aria-hidden="true" class="header-anchor">#</a> 在小程序中的方法</h3> <ul><li>小程序需要在页面内点击按钮分享的时候，使用button 组件来发起分享事件(onShareAppMessage)。</li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>flexCol<span class="token punctuation">&quot;</span></span> <span class="token attr-name">open-type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>share<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>shareIcon weixinIcon<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>shareText<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>分享给好友<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>小程序分享需要定义分享函数。</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">onShareAppMessage</span> <span class="token punctuation">(</span>ops<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'分享'</span><span class="token punctuation">,</span> ops<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    title<span class="token punctuation">:</span> <span class="token string">'xxxxx'</span><span class="token punctuation">,</span>
    imageUrl<span class="token punctuation">:</span> <span class="token string">'https://www.xxxxx.xx.png'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><p>小程序需要通过 wx.login API 去换取 jsCode，通过jsCode 后台来获取openId(微信用户的唯一标识)。</p></li> <li><p>小程序中canvas 或者 通过 wx.createAnimation（动画）需要的是 px 或 number，这个时候就需要通过 wx.getSystemInfoSync 来获取系统信息，来动态的去计算所需的值。</p></li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> systemInfo <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">getSystemInfoSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 用 系统的宽度 除 设计稿的 宽度  就是 2.48344 现在这个值</span>
<span class="token keyword">let</span> x <span class="token operator">=</span> systemInfo<span class="token punctuation">.</span>windowWidth <span class="token operator">/</span> <span class="token number">2.48344</span>
<span class="token keyword">let</span> z <span class="token operator">=</span> systemInfo<span class="token punctuation">.</span>windowWidth <span class="token operator">/</span> <span class="token number">3.75</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>animation1<span class="token punctuation">.</span><span class="token function">translate3d</span><span class="token punctuation">(</span><span class="token operator">-</span>x<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> z<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">step</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>在小程序跳转到另一个页面，需要再次返回回来的时候，并且在当前页面需要获取从另一给页面获取相应的数据等，可以在最外定义 pageObj， 在当前页面初次 onLoad 时候 把 this 赋值给 pageObj，在另一个页面完成方法并且通过 wx.navigateBack 返回时，在 success 方法里 可以调用 app.pageObj.onLoad() 掉用前一个页面的方法。</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// index.js</span>
<span class="token function">onLoad</span> <span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  app<span class="token punctuation">.</span>pageObj <span class="token operator">=</span> <span class="token keyword">this</span>
<span class="token punctuation">}</span>
<span class="token comment">// login.js</span>
wx<span class="token punctuation">.</span><span class="token function">navigateBack</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  delta<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  success<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    app<span class="token punctuation">.</span>pageObj<span class="token punctuation">.</span><span class="token function">onLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="小程序指定页面二维码"><a href="#小程序指定页面二维码" aria-hidden="true" class="header-anchor">#</a> 小程序指定页面二维码</h3> <ul><li>可以看小程序文档获取二维码api文档。</li> <li>或者 <code>使用 Vue CLI 3 来写的</code> <a href="https://github.com/magicLaLa/GetWxCode" target="_blank" rel="noopener noreferrer">https://github.com/magicLaLa/GetWxCode<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="mpvue"><a href="#mpvue" aria-hidden="true" class="header-anchor">#</a> MPVUE</h2> <ul><li>获取微信小程序实例，可以通过</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">this</span><span class="token punctuation">.</span>$root<span class="token punctuation">.</span>$mp <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$mp <span class="token comment">// 来获取</span>
</code></pre></div><ul><li>小程序中弹窗出来，不让页面进行滚动，可以在 遮罩 和 弹窗上增加 <code>catchtouchmove</code></li></ul> <div class="language-html extra-class"><pre class="language-html"><code>!-- 遮罩 --&gt;
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>isShowModel<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>model<span class="token punctuation">&quot;</span></span> <span class="token attr-name">catchtouchmove</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>有时候需要和 小程序的生命周期混用。</li> <li>不支持在组件上绑定事件，例如：<code>@click</code>。如果要子组件中出发父组件事件，使用<code>vuex</code>来统一管理。</li> <li>不支持使用<code>mapState mapGetters mapActions mapMutations</code> 辅助函数。可以在每个<code>.vue</code>模板中单独引用<code>import store from './store/stroe.js'</code>。然后通过使用 <code>store.commit(...)/store.dispatch(...)</code>来触发事件。</li> <li>可以在<code>main.js</code>里面设置<code>vue.prototype.store = store</code>，就可以使用辅助函数了。</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// src =&gt; store =&gt; index.js</span>
<span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> Vuex <span class="token keyword">from</span> <span class="token string">'vuex'</span>

Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Vuex<span class="token punctuation">)</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  state<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    isAn<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 轮播切换</span>
    isShowModel<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 是否展示遮罩</span>
    isShareBox<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 是否展示分享弹窗</span>
    systemInfo<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment">// 系统信息</span>
    pageObj<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment">// 页面实例</span>
    popupFunObj<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token comment">// 弹窗两个方法</span>
      comfirm<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
      cancel<span class="token punctuation">:</span> <span class="token string">''</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    isLogin<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 是否登录</span>
    localName<span class="token punctuation">:</span> <span class="token string">''</span> <span class="token comment">// 登录地点</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  mutations<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    change<span class="token punctuation">:</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'mutations change'</span><span class="token punctuation">)</span>
      <span class="token keyword">const</span> obj <span class="token operator">=</span> state
      obj<span class="token punctuation">.</span>isAn<span class="token operator">++</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    decrement<span class="token punctuation">:</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> obj <span class="token operator">=</span> state
      obj<span class="token punctuation">.</span>count <span class="token operator">-=</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> store

<span class="token comment">// src =&gt; main.js</span>
<span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App'</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'@/store/index'</span>

Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>productionTip <span class="token operator">=</span> <span class="token boolean">false</span>
App<span class="token punctuation">.</span>mpType <span class="token operator">=</span> <span class="token string">'app'</span>

Vue<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$store <span class="token operator">=</span> store

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// src =&gt; index =&gt; index.vue</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> mapState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  computed<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span><span class="token function">mapState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'isShowModel'</span><span class="token punctuation">,</span> <span class="token string">'isShareBox'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>因为小程序不支持在模板语法里<code>{{}}</code> 复杂的计算，所以在 mpvue 中也不能进行复杂的计算。</li> <li>在原生小程序中访问下程序实例是通过<code>getApp()</code>来获取定义在<code>app.js中的函数和自定义的属性</code>，在<code>mpVue</code>中在<code>created/mounted/onLoad...</code>中调用<code>getApp()</code>获取不到在<code>app.js</code>中自定义的一些属性，在<code>mpVue</code>中推荐使用<code>VUEX</code>来集中管理公共的自定义的一些属性和方法。</li> <li>最新版的 app.json 是单独放到 src 下面，不是在 main.js 里面去写自动生成页面路径添加到 pages 里面，每一个 page 也是单独把 main.json 放到单独的页面文件下。</li></ul> <p><img src="/img/APPjson.png" alt="Alt text"> <img src="/img/pagejson.png" alt="Alt text"></p> <ul><li>可以写背景图片，把背景图片放到 <code>src =&gt; assets =&gt; images</code> 下。然后在 scss 中 通过 <code>background: url(~@/assets/images/top.png) no-repeat;</code>来使用，然后需要在 <code>build =&gt; webpack.base.conf.js</code> 修改 module。</li></ul> <p><img src="/img/imgimg.png" alt="Alt text"></p> <ul><li>也可以使用精灵图（雪碧图）来写， 具体代码如下:</li></ul> <p>webpack.base.conf.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 自动雪碧图</span>
<span class="token keyword">const</span> spritesmith <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-spritesmith'</span><span class="token punctuation">)</span>

<span class="token comment">// 雪碧图位置</span>
<span class="token keyword">const</span> <span class="token constant">SPRITES</span> <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../src/sprites/'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token constant">SPRITES_SUB</span> <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../src/sprites/*'</span><span class="token punctuation">)</span>

<span class="token comment">// 雪碧图方法</span>
<span class="token keyword">function</span> <span class="token function">generateSprites</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> glob<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token constant">SPRITES_SUB</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>filenames <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> pathName <span class="token operator">=</span> filenames<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token constant">SPRITES</span><span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">spritesmith</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      src<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        cwd<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token constant">SPRITES</span><span class="token punctuation">,</span> pathName<span class="token punctuation">)</span><span class="token punctuation">,</span>
        glob<span class="token punctuation">:</span> <span class="token string">'*.png'</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      target<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        image<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../src/sprite-generate/sprite-'</span> <span class="token operator">+</span> pathName <span class="token operator">+</span> <span class="token string">'.png'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        css<span class="token punctuation">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">[</span>
            path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../src/sprite-generate/_sprite-'</span> <span class="token operator">+</span> pathName <span class="token operator">+</span> <span class="token string">'.scss'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
              format<span class="token punctuation">:</span> <span class="token string">'handlebars_based_template'</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      apiOptions<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        cssImageRef<span class="token punctuation">:</span> <span class="token string">'~sprite-'</span> <span class="token operator">+</span> pathName <span class="token operator">+</span> <span class="token string">'.png'</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      customTemplates<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        handlebars_based_template<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../scss.template.handlebars'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      spritesmithOptions<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        padding<span class="token punctuation">:</span> <span class="token number">6</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token punctuation">,</span>
  resolve<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    extensions<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'.js'</span><span class="token punctuation">,</span> <span class="token string">'.vue'</span><span class="token punctuation">,</span> <span class="token string">'.json'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    modules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'node_modules'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src/sprite-generate'</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    alias<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token string">'vue'</span><span class="token punctuation">:</span> <span class="token string">'mpvue'</span><span class="token punctuation">,</span>
      <span class="token string">'@'</span><span class="token punctuation">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    symlinks<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    aliasFields<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'mpvue'</span><span class="token punctuation">,</span> <span class="token string">'weapp'</span><span class="token punctuation">,</span> <span class="token string">'browser'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    mainFields<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'browser'</span><span class="token punctuation">,</span> <span class="token string">'module'</span><span class="token punctuation">,</span> <span class="token string">'main'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span><span class="token punctuation">,</span>
    <span class="token operator">...</span><span class="token function">generateSprites</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>需要在 <code>src =&gt; sprite-generate | sprites</code> 新建这两个文件夹。</p> <p><img src="/img/generateSprites.png" alt="Alt text"></p></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">9/22/2018, 5:58:35 PM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/Blog/Node/node版本管理.html" class="prev">
          node版本管理
        </a></span> <!----></p></div> </div> <!----></div></div>
    <script src="/assets/js/6.58992cca.js" defer></script><script src="/assets/js/app.3974c7c8.js" defer></script>
  </body>
</html>
