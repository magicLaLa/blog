<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vue相关 | 森林土豆</title>
    <meta name="description" content="人间熙攘，好久不见">
    <link rel="icon" href="/img/logo.ico">
  <link rel="manifest" href="/manifest.json">
  <link rel="apple-touch-icon" href="/img/logo.png">
    
    <link rel="preload" href="/assets/css/0.styles.0e4fdce5.css" as="style"><link rel="preload" href="/assets/js/app.c6f4e4c4.js" as="script"><link rel="preload" href="/assets/js/17.504682f1.js" as="script"><link rel="prefetch" href="/assets/js/10.d6230fe5.js"><link rel="prefetch" href="/assets/js/11.a8da0024.js"><link rel="prefetch" href="/assets/js/12.330e0f83.js"><link rel="prefetch" href="/assets/js/13.3e4e25c5.js"><link rel="prefetch" href="/assets/js/14.f5e46c9e.js"><link rel="prefetch" href="/assets/js/15.21be2681.js"><link rel="prefetch" href="/assets/js/16.5ec3ea9d.js"><link rel="prefetch" href="/assets/js/18.6c486db0.js"><link rel="prefetch" href="/assets/js/19.a55b746b.js"><link rel="prefetch" href="/assets/js/2.979492e9.js"><link rel="prefetch" href="/assets/js/20.5493beb9.js"><link rel="prefetch" href="/assets/js/3.04921920.js"><link rel="prefetch" href="/assets/js/4.d05fc0ac.js"><link rel="prefetch" href="/assets/js/5.1533e6fe.js"><link rel="prefetch" href="/assets/js/6.b547afbb.js"><link rel="prefetch" href="/assets/js/7.b06df096.js"><link rel="prefetch" href="/assets/js/8.726bd949.js"><link rel="prefetch" href="/assets/js/9.3ee49416.js">
    <link rel="stylesheet" href="/assets/css/0.styles.0e4fdce5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">森林土豆</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">分类</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Blog/JavaScript/ES6的一些方法和技巧.html" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/Blog/GIT/git的一些总结.html" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/Blog/Node/node版本管理.html" class="nav-link">Node</a></li><li class="dropdown-item"><!----> <a href="/Blog/MiniPrograms/MiniPrograms.html" class="nav-link">MiniPrograms</a></li><li class="dropdown-item"><!----> <a href="/Blog/VUE/vue.html" class="nav-link router-link-exact-active router-link-active">VUE</a></li><li class="dropdown-item"><!----> <a href="/Blog/Other/gulp.html" class="nav-link">Other</a></li></ul></div></div> <a href="https://github.com/magicLaLa/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">分类</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Blog/JavaScript/ES6的一些方法和技巧.html" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/Blog/GIT/git的一些总结.html" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/Blog/Node/node版本管理.html" class="nav-link">Node</a></li><li class="dropdown-item"><!----> <a href="/Blog/MiniPrograms/MiniPrograms.html" class="nav-link">MiniPrograms</a></li><li class="dropdown-item"><!----> <a href="/Blog/VUE/vue.html" class="nav-link router-link-exact-active router-link-active">VUE</a></li><li class="dropdown-item"><!----> <a href="/Blog/Other/gulp.html" class="nav-link">Other</a></li></ul></div></div> <a href="https://github.com/magicLaLa/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Git</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Node</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>MiniPrograms</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>VUE</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/Blog/VUE/vue.html" class="active sidebar-link">Vue相关</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Blog/VUE/vue.html#vue配置相关" class="sidebar-link">Vue配置相关</a></li><li class="sidebar-sub-header"><a href="/Blog/VUE/vue.html#vue-watch选项" class="sidebar-link">Vue watch选项</a></li><li class="sidebar-sub-header"><a href="/Blog/VUE/vue.html#vue中盲点" class="sidebar-link">vue中盲点</a></li><li class="sidebar-sub-header"><a href="/Blog/VUE/vue.html#vue图表-v-charts" class="sidebar-link">vue图表-V-charts</a></li><li class="sidebar-sub-header"><a href="/Blog/VUE/vue.html#vue后台管理模板" class="sidebar-link">vue后台管理模板</a></li></ul></li><li><a href="/Blog/VUE/workRelated.html" class="sidebar-link">遇到的问题</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Other</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="vue相关"><a href="#vue相关" aria-hidden="true" class="header-anchor">#</a> Vue相关</h1> <h2 id="vue配置相关"><a href="#vue配置相关" aria-hidden="true" class="header-anchor">#</a> Vue配置相关</h2> <h3 id="代理配置"><a href="#代理配置" aria-hidden="true" class="header-anchor">#</a> 代理配置</h3> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span>
  dev<span class="token punctuation">:</span> <span class="token punctuation">{</span>      <span class="token comment">// 开发环境配置</span>
    env<span class="token punctuation">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./dev.env'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token comment">// 使用 config/dev.env.js 中定义的编译环境</span>
    port<span class="token punctuation">:</span> <span class="token number">8686</span><span class="token punctuation">,</span>     <span class="token comment">// 运行测试页面的端口号</span>
    autoOpenBrowser<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    assetsSubDirectory<span class="token punctuation">:</span> <span class="token string">'static'</span><span class="token punctuation">,</span>     <span class="token comment">// 编译输出的二级目录</span>
    assetsPublicPath<span class="token punctuation">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>      <span class="token comment">// 编译发布的根目录，可配置为资源服务器域名或 CDN 域名</span>
    <span class="token comment">// 需要 proxyTable 代理的接口（可跨域）</span>
    proxyTable<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token string">'**'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        target<span class="token punctuation">:</span> <span class="token string">'https://xxxxxxx'</span><span class="token punctuation">,</span>
        changeOrigin<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        filter<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>pathname<span class="token punctuation">,</span> req<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 接口地址 /******-server/****/******</span>
          <span class="token keyword">return</span> pathname<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token string">'^\/.+-server.*'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    cssSourceMap<span class="token punctuation">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="多入口配置"><a href="#多入口配置" aria-hidden="true" class="header-anchor">#</a> 多入口配置</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/* utils.js */</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// glob 是 webpack 安装时依赖的一个第三方模块，还模块允许你使用 * 等符号,</span>
<span class="token comment">// 例如 lib/*.js 就是获取 lib 文件夹下的所有 js 后缀名的文件</span>
<span class="token keyword">const</span> glob <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'glob'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 取得相应的页面路径，因为之前的配置，所以是 src 文件夹下的 pages 文件夹</span>
<span class="token keyword">const</span> <span class="token constant">PAGE_PATH</span> <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../src/pages'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token operator">/</span><span class="token operator">*</span>
<span class="token operator">*</span> 多入口配置
<span class="token operator">*</span> 通过 glob 模块读取 pages 文件夹下的所有对应文件夹下的 js <span class="token operator">*</span> 后缀文件，如果该文件存在
<span class="token operator">*</span> 那么就作为入口处理
<span class="token operator">*</span><span class="token operator">/</span>
exports<span class="token punctuation">.</span><span class="token function-variable function">getEntries</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> entryFiles <span class="token operator">=</span> glob<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token constant">PAGE_PATH</span> <span class="token operator">+</span> <span class="token string">'/*/*.js'</span><span class="token punctuation">)</span> <span class="token comment">// 同步读取所有入口文件</span>
  <span class="token keyword">let</span> map <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token operator">/</span><span class="token operator">/</span> 遍历所有入口文件
  entryFiles<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>filePath <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token operator">/</span><span class="token operator">/</span> 获取文件名
    <span class="token keyword">let</span> filename <span class="token operator">=</span> filePath<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>filePath<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">'\/'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> filePath<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token operator">/</span><span class="token operator">/</span> 以键值对的形式存储
    map<span class="token punctuation">[</span>filename<span class="token punctuation">]</span> <span class="token operator">=</span> filePath
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> map
<span class="token punctuation">}</span>
</code></pre></div><ul><li>上方我们使用了 <code>glob</code> 这一第三方模块读取所有 pages 文件夹下的入口文件，其需要进行安装：<code>yarn add glob --dev</code></li> <li>可以将返回的入口文件对象其设置到 webpack 的 entry 属性上</li></ul> <h3 id="多模板配置"><a href="#多模板配置" aria-hidden="true" class="header-anchor">#</a> 多模板配置</h3> <ul><li>模板文件的作用主要用于 webpack 中 <code>html-webpack-plugin</code> 插件的配置，其会根据模板文件生产一个编译后的 html 文件并自动加入携带 hash 的脚本和样式，基本配置如下：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/* webpack 配置文件 */</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span> <span class="token comment">// 安装并引用插件</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
    plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        title<span class="token punctuation">:</span> <span class="token string">'My Page'</span><span class="token punctuation">,</span> <span class="token comment">// 生成 html 中的 title</span>
        filename<span class="token punctuation">:</span> <span class="token string">'demo.html'</span><span class="token punctuation">,</span> <span class="token comment">// 生成 html 的文件名</span>
        template<span class="token punctuation">:</span> <span class="token string">'xxx/xxx/demo.html'</span><span class="token punctuation">,</span> <span class="token comment">// 模板路径</span>
        chunks<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'manifest'</span><span class="token punctuation">,</span> <span class="token string">'vendor'</span><span class="token punctuation">,</span> <span class="token string">'demo'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 所要包含的模块</span>
        inject<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 是否注入资源</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>以上是单模板的配置，那么如果是多模板只要继续往 plugins 数组中添加 HtmlWebpackPlugin 即可，但是为了和多入口一样能够灵活的获取 pages 目录下所有模板文件并进行配置，可以在 utils.js 中添加多模板的读取解析方法：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/* utils.js */</span>

<span class="token comment">// 多页面输出配置</span>
<span class="token comment">// 与上面的多页面入口配置相同，读取 page 文件夹下的对应的 html 后缀文件，然后放入数组中</span>
exports<span class="token punctuation">.</span><span class="token function-variable function">htmlPlugin</span> <span class="token operator">=</span> configs <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> entryHtml <span class="token operator">=</span> glob<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token constant">PAGE_PATH</span> <span class="token operator">+</span> <span class="token string">'/*/*.html'</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    entryHtml<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>filePath <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> filename <span class="token operator">=</span> filePath<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>filePath<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">'\/'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> filePath<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token keyword">let</span> conf <span class="token operator">=</span> <span class="token punctuation">{</span>
        template<span class="token punctuation">:</span> filePath<span class="token punctuation">,</span> <span class="token comment">// 模板路径</span>
        filename<span class="token punctuation">:</span> filename <span class="token operator">+</span> <span class="token string">'.html'</span><span class="token punctuation">,</span> <span class="token operator">/</span><span class="token operator">/</span> 生成 html 的文件名
        chunks<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'manifest'</span><span class="token punctuation">,</span> <span class="token string">'vendor'</span><span class="token punctuation">,</span> filename<span class="token punctuation">]</span><span class="token punctuation">,</span>
        inject<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">/</span> 如果有自定义配置可以进行 merge
      <span class="token keyword">if</span> <span class="token punctuation">(</span>configs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        conf <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>conf<span class="token punctuation">,</span> configs<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">/</span> 针对生产环境配置
      <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        conf <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>conf<span class="token punctuation">,</span> <span class="token punctuation">{</span>
          minify<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            removeComments<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token operator">/</span><span class="token operator">/</span> 删除 html 中的注释代码
            collapseWhitespace<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token operator">/</span><span class="token operator">/</span> 删除 html 中的空白符
            <span class="token operator">/</span><span class="token operator">/</span> removeAttributeQuotes<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token operator">/</span><span class="token operator">/</span> 删除 html 元素中属性的引号
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          chunksSortMode<span class="token punctuation">:</span> <span class="token string">'manual'</span> <span class="token operator">/</span><span class="token operator">/</span> 按 manual 的顺序引入
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>

      arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span>conf<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> arr
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>注：<a href="https://github.com/kangax/html-minifier" target="_blank" rel="noopener noreferrer">minify<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 配置的作用：将 html-minifier 的选项作为对象来缩小输出</p></blockquote> <h3 id="在-vue-cli3-使用-pages-配置"><a href="#在-vue-cli3-使用-pages-配置" aria-hidden="true" class="header-anchor">#</a> 在 vue-cli3 使用 pages 配置</h3> <ul><li>将多入口和多模板的方法就可以合并成一个函数来进行多页的处理，合并后的 setPages 方法如下：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

<span class="token comment">// glob是webpack安装时依赖的一个第三方模块，还模块允许你使用 *等符号,</span>
<span class="token comment">// 例如lib/*.js就是获取lib文件夹下的所有js后缀名的文件</span>
<span class="token keyword">const</span> glob <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'glob'</span><span class="token punctuation">)</span>

<span class="token comment">// 取得相应的页面路径，因为之前的配置，所以是src文件夹下的pages文件夹</span>
<span class="token keyword">const</span> <span class="token constant">PAGE_PATH</span> <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../src/pages/'</span><span class="token punctuation">)</span>

<span class="token comment">// 用于做相应的merge处理</span>
<span class="token keyword">const</span> merge <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-merge'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> <span class="token constant">ENTRY</span> <span class="token operator">=</span> <span class="token string">'main.js'</span>
<span class="token comment">// pages 多入口配置</span>
exports<span class="token punctuation">.</span><span class="token function-variable function">setPages</span> <span class="token operator">=</span> configs <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> entryFiles <span class="token operator">=</span> glob<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token constant">PAGE_PATH</span> <span class="token operator">+</span> <span class="token string">'/**/'</span> <span class="token operator">+</span> <span class="token constant">ENTRY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> map <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    entryFiles<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>filePath <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> tmp <span class="token operator">=</span> filePath<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> filePath<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token constant">ENTRY</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> fileName <span class="token operator">=</span> filePath<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token constant">PAGE_PATH</span><span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> filePath<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token constant">ENTRY</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>

        <span class="token keyword">let</span> conf <span class="token operator">=</span> <span class="token punctuation">{</span>
          <span class="token comment">// page 的入口</span>
          entry<span class="token punctuation">:</span> filePath<span class="token punctuation">,</span>
          <span class="token comment">// 模板来源</span>
          template<span class="token punctuation">:</span> tmp <span class="token operator">+</span> <span class="token string">'index.html'</span><span class="token punctuation">,</span>
          <span class="token comment">// 在 dist/index.html 的输出</span>
          filename<span class="token punctuation">:</span> fileName <span class="token operator">+</span> <span class="token string">'.html'</span><span class="token punctuation">,</span>
          <span class="token comment">// 页面模板需要加对应的js脚本，如果不加这行则每个页面都会引入所有的js脚本</span>
          chunks<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'chunk-vendors'</span><span class="token punctuation">,</span> <span class="token string">'chunk-common'</span><span class="token punctuation">,</span> fileName<span class="token punctuation">]</span>
          <span class="token comment">// inject: true</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'conf'</span><span class="token punctuation">,</span> conf<span class="token punctuation">)</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>configs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            conf <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>conf<span class="token punctuation">,</span> configs<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            conf <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>conf<span class="token punctuation">,</span> <span class="token punctuation">{</span>
                minify<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                    removeComments<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 删除html中的注释代码</span>
                    collapseWhitespace<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 删除html中的空白符</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                chunksSortMode<span class="token punctuation">:</span> <span class="token string">'manual'</span><span class="token comment">// 按manual的顺序引入</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        map<span class="token punctuation">[</span>fileName<span class="token punctuation">]</span> <span class="token operator">=</span> conf<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> map
<span class="token punctuation">}</span>
</code></pre></div><ul><li>上述代码我们 return 出的 map 对象就是 pages 所需要的配置项结构，我们只需在 vue.config.js 中引用即可：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/* vue.config.js */</span>
<span class="token keyword">const</span> utils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./build/utils'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>

  pages<span class="token punctuation">:</span> utils<span class="token punctuation">.</span><span class="token function">setPages</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

  <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="vue-watch选项"><a href="#vue-watch选项" aria-hidden="true" class="header-anchor">#</a> Vue watch选项</h2> <ul><li><p>watch 的用法</p></li> <li><p>watch 对象里的 value 是对应的回调函数</p></li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    a<span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
watch<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  a<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>newVal<span class="token punctuation">,</span> oldVal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newVal<span class="token punctuation">,</span> oldVal<span class="token punctuation">)</span>
    <span class="token comment">// 2 1</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token function">created</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">2</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>value 也可以是方法名</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    a<span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
watch<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  a<span class="token punctuation">:</span> <span class="token string">'foo'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token function">created</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">2</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  <span class="token function">foo</span> <span class="token punctuation">(</span>newVal<span class="token punctuation">,</span> oldVal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newVal<span class="token punctuation">,</span> oldVal<span class="token punctuation">)</span>
    <span class="token comment">// 2 1</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>深度监听 <em>对象内部属性或方法发生改变，须使用深度监听模式才能监听到该对象的改变</em></li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    box<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      name<span class="token punctuation">:</span> <span class="token string">'jordan'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
watch<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  box<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    handler<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>newVal<span class="token punctuation">,</span> oldVal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newVal<span class="token punctuation">.</span>name<span class="token punctuation">,</span> oldVal<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
      <span class="token comment">// kobe kobe</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    deep<span class="token punctuation">:</span> <span class="token boolean">true</span>  <span class="token comment">// 深度监听模式</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token function">created</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>box<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'kobe'</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>不使用深度监听时，可以直接监听 xxx.name</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    box<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      name<span class="token punctuation">:</span> <span class="token string">'jordan'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
watch<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  <span class="token string">'box.name'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    handler<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>newVal<span class="token punctuation">,</span> oldVal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newVal<span class="token punctuation">,</span> oldVal<span class="token punctuation">)</span>
      <span class="token comment">// kobe jordan</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token function">created</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>box<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'lalala'</span>
<span class="token punctuation">}</span>
<span class="token comment">// 这时 box.name 又是一个简单值，所以输出 'lalala jordan'</span>
</code></pre></div><ul><li>数组的监听</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    box<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
watch<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  box<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    handler<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'watch works'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token function">created</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>box<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>box<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">4</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>box<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment">// watch works</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>box<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment">// watch works</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p><em>created 里使用了4种方式对 box 进行操作，第一种和第二种方式 watch 是监听不到的，即便使用深度监听模式也无法监听的到。</em> <a href="https://cn.vuejs.org/v2/guide/list.html#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9" target="_blank" rel="noopener noreferrer">可以参考<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <ul><li>使用 immediate</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    box<span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
watch<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  box<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    handler<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'watch works'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    immediate<span class="token punctuation">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// watch works</span>
</code></pre></div><blockquote><p>增加 immediate: true 选项，handler 会在侦听开始之后被立即调用，即便 box 的值没有改变。如果对 this.box 的值加以修改，便会输出两次 'watch works'，一次是侦听开始的时候，一次是 box 的值被修改的时候</p></blockquote> <ul><li>watch 里的 value 可以是放在一个数组里面的多个 handler</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    box<span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
watch<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  box<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">function</span> <span class="token function">foo</span> <span class="token punctuation">(</span>newVal<span class="token punctuation">,</span> oldVal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newVal<span class="token punctuation">,</span> oldVal<span class="token punctuation">)</span>
      <span class="token comment">// 2 1</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span> <span class="token function">bar</span> <span class="token punctuation">(</span>newVal<span class="token punctuation">,</span> oldVal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newVal<span class="token punctuation">,</span> oldVal<span class="token punctuation">)</span>
      <span class="token comment">// 2 1</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token function">created</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>box <span class="token operator">=</span> <span class="token number">2</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>每一个 handler 都可以接收 new value 和 old value 两个参数，并且会按各自在数组中的顺序先后触发。当然下面的操作也能实现这样的场景：</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    box<span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
watch<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  box<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>newVal<span class="token punctuation">,</span> oldVal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span>newVal<span class="token punctuation">,</span> oldVal<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">bar</span><span class="token punctuation">(</span>newVal<span class="token punctuation">,</span> oldVal<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token function">created</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>box <span class="token operator">=</span> <span class="token number">2</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  <span class="token function">foo</span> <span class="token punctuation">(</span>newVal<span class="token punctuation">,</span> oldVal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newVal<span class="token punctuation">,</span> oldVal<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">bar</span> <span class="token punctuation">(</span>newVal<span class="token punctuation">,</span> oldVal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newVal<span class="token punctuation">,</span> oldVal<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p><strong>不应该使用箭头函数来定义 watcher 函数</strong></p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    box<span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
watch<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  box<span class="token punctuation">:</span> newVal <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateBox</span><span class="token punctuation">(</span>newVal<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token function">created</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>box <span class="token operator">=</span> <span class="token number">2</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  <span class="token function">updateBox</span> <span class="token punctuation">(</span>newVal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>box <span class="token operator">=</span> newVal
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><blockquote><p><strong>上面的例子会报错，是因为箭头函数绑定了父级作用域的上下文，所以 this 将不会指向 Vue 实例，也就没有 this.updateBox 这个方法，可以参考 es6箭头函数this的指向</strong></p></blockquote></blockquote> <h2 id="vue中盲点"><a href="#vue中盲点" aria-hidden="true" class="header-anchor">#</a> vue中盲点</h2> <h3 id="使用-performance-开启性能追踪"><a href="#使用-performance-开启性能追踪" aria-hidden="true" class="header-anchor">#</a> 使用 performance 开启性能追踪</h3> <ul><li>performance API 是 Vue 全局配置 API 中的一个，我们可以使用它来进行网页性能的追踪，我们可以在入口文件中添加：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>performance <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>来开启这一功能，该 API（2.2.0 新增）功能只适用于开发模式和支持 performance.mark API 的浏览器上，开启后我们可以下载 Vue Performance Devtool 这一 chrome 插件来看查看各个组件的加载情况，如图：</p> <p><img src="/img/performance.png" alt="performance"></p> <p>从中我们可以清晰的看到页面组件在每个阶段的耗时情况，而针对耗时比较久的组件，我们便可以对其进行相应优化。<br>
而其在 Vue 源码中主要使用了 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Performance" target="_blank" rel="noopener noreferrer">window.performance<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 来获取网页性能数据，其中包含了 performance.mark 和 performance.measure。</p> <ul><li>performance.mark 主要用于创建标记</li> <li>performance.measure 主要用于记录两个标记的时间间隔</li></ul> <p>例如：</p> <div class="language-js extra-class"><pre class="language-js"><code>performance<span class="token punctuation">.</span><span class="token function">mark</span><span class="token punctuation">(</span><span class="token string">'start'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建 start 标记</span>
performance<span class="token punctuation">.</span><span class="token function">mark</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建 end 标记</span>

performance<span class="token punctuation">.</span><span class="token function">measure</span><span class="token punctuation">(</span><span class="token string">'output'</span><span class="token punctuation">,</span> <span class="token string">'start'</span><span class="token punctuation">,</span> <span class="token string">'end'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 计算两者时间间隔</span>

performance<span class="token punctuation">.</span><span class="token function">getEntriesByName</span><span class="token punctuation">(</span><span class="token string">'output'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取标记，返回值是一个数组，包含了间隔时间数据</span>
</code></pre></div><p>熟练的使用 performance 我们可以查看并分析网页的很多数据，为我们项目优化提供保障。</p> <h3 id="对低开销的静态组件使用-v-once"><a href="#对低开销的静态组件使用-v-once" aria-hidden="true" class="header-anchor">#</a> 对低开销的静态组件使用 v-once</h3> <p>Vue 提供了 v-once 指令用于只渲染元素和组件一次，一般可以用于存在大量静态数据组件的更新性能优化，注意是大量静态数据，因为少数情况下我们的页面渲染会因为一些静态数据而变慢。如果需要对一个组件使用 v-once，可以直接在组件上绑定：</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>box-content</span> <span class="token attr-name">v-once</span> <span class="token attr-name">:data</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>msg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>box-content</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>这时候因为组件绑定了 v-once，所以无论 msg 的值如何变化，组件内渲染的永远是其第一次获取到的初始值。因此我们在使用 v-once 的时候需要考虑该组件今后的更新情况，避免不必要的问题产生。</p> <h3 id="使用-isserver-判断当前实例是否运行于服务器"><a href="#使用-isserver-判断当前实例是否运行于服务器" aria-hidden="true" class="header-anchor">#</a> 使用 $isServer 判断当前实例是否运行于服务器</h3> <p>当我们的 Vue 项目中存在服务端渲染（SSR）的时候，有些项目文件可能会同时在客户端和服务端加载，这时候代码中的一些客户端浏览器才支持的属性或变量在服务端便会加载出错，比如 window、 document 等，这时候我们需要进行环境的判断来区分客户端和服务端，如果你不知道 <code>$isServer</code>，那么你可能会使用 <code>try ... catch</code> 或者 <code>process.env.VUE_ENV</code> 来判断：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">try</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'test'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">// process.env.VUE_ENV 需要在 webpack 中进行配置</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VUE_ENV</span> <span class="token operator">===</span> <span class="token string">'client'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'test'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>而使用 $isServer 则无需进行配置，在组件中直接使用该 API 即可：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$isServer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'test'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>其源码中使用了 Object.defineProperty 来进行数据监测：</p> <div class="language-js extra-class"><pre class="language-js"><code>Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>Vue<span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token string">'$isServer'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token keyword">get</span><span class="token punctuation">:</span> isServerRendering
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> _isServer<span class="token punctuation">;</span>
<span class="token keyword">var</span> <span class="token function-variable function">isServerRendering</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_isServer <span class="token operator">===</span> undefined<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>inBrowser <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>inWeex <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> global <span class="token operator">!==</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            _isServer <span class="token operator">=</span> global<span class="token punctuation">[</span><span class="token string">'process'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VUE_ENV</span> <span class="token operator">===</span> <span class="token string">'server'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            _isServer <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> _isServer
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>当我们访问 $isServer 属性时，其会调用 <code>isServerRendering</code>方法，该方法会首先判断当前环境，如果在浏览器或者 Weex 下则返回 false，否则继续判断当前全局环境下的 <code>process.env.VUE_ENV</code> 是否为 server 来返回最终结果。</p> <h2 id="vue图表-v-charts"><a href="#vue图表-v-charts" aria-hidden="true" class="header-anchor">#</a> vue图表-V-charts</h2> <ul><li><a href="https://v-charts.js.org/#/" target="_blank" rel="noopener noreferrer">V-charts 文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="vue后台管理模板"><a href="#vue后台管理模板" aria-hidden="true" class="header-anchor">#</a> vue后台管理模板</h2> <ul><li><a href="https://panjiachen.github.io/vue-element-admin-site/zh/guide/" target="_blank" rel="noopener noreferrer">vue-element-admin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/Blog/MiniPrograms/MiniPrograms.html" class="prev">
          小程序相关
        </a></span> <span class="next"><a href="/Blog/VUE/workRelated.html">
          遇到的问题
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/17.504682f1.js" defer></script><script src="/assets/js/app.c6f4e4c4.js" defer></script>
  </body>
</html>
