(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{165:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[t._m(0),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://hapijs.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("官网"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://hapijs.com/api",target:"_blank",rel:"noopener noreferrer"}},[t._v("Hapi-api"),a("OutboundLink")],1)])]),t._v(" "),t._m(4),t._v(" "),t._m(5),t._v(" "),t._m(6),t._m(7),t._v(" "),t._m(8),t._m(9),t._v(" "),t._m(10),t._v(" "),t._m(11),t._m(12),t._v(" "),t._m(13),t._v(" "),t._m(14),t._m(15),t._v(" "),t._m(16),t._v(" "),t._m(17),t._m(18),t._m(19),t._v(" "),t._m(20),t._v(" "),t._m(21),t._m(22),t._v(" "),t._m(23),t._v(" "),t._m(24),t._m(25),t._v(" "),t._m(26),t._m(27),t._v(" "),a("ul",[a("li",[t._v("数据库为 MySQL 5.6。"),a("a",{attrs:{href:"https://sequelize.readthedocs.io/en/v3/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Sequelize"),a("OutboundLink")],1),t._v(" 则是 Node.js 生态中一款知名的基于 promise 数据库 ORM 插件，提供了大量常用数据库增删改查的函数式 API，以帮助我们在实际开发中，大量减少书写冗长的基础数据库查询语句。")]),t._v(" "),t._m(28)]),t._v(" "),t._m(29),t._m(30),t._v(" "),t._m(31),t._v(" "),t._m(32),t._m(33),t._v(" "),t._m(34),t._m(35),t._m(36),t._v(" "),a("p",[t._v("执行下面的命令，可以默认使用 development 下的配置，来创建项目数据库。增加例如 --env production，则使用 config/config.js 中的 production 项配置，来完成数据库的创建。")]),t._v(" "),t._m(37),t._m(38),t._v(" "),t._m(39),t._v(" "),t._m(40),t._m(41),t._v(" "),t._m(42),t._m(43),t._m(44),t._v(" "),t._m(45),t._m(46),t._m(47),t._m(48),t._v(" "),t._m(49),t._v(" "),t._m(50),t._m(51),t._v(" "),t._m(52),t._m(53),t._v(" "),a("ul",[a("li",[t._v("Sequelize 连接数据库的核心代码主要就是通过 new Sequelize（database, username, password, options） 来实现，其中 options 中的配置选项，除了最基础的 host 与 port、数据库类型外，还可以设置连接池的连接参数 pool，数据模型命名规范 underscored 等等。具体可以查阅官方手册 "),a("a",{attrs:{href:"http://docs.sequelizejs.com/manual/installation/usage.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("基础使用"),a("OutboundLink")],1),t._v("。"),t._m(54)])]),t._v(" "),t._m(55),t._v(" "),t._m(56),t._v(" "),t._m(57),t._m(58),t._v(" "),t._m(59),t._v(" "),t._m(60),a("ul",[a("li",[t._v("列表分页 "),a("code",[t._v("options")]),t._v(" 的具体配置参数细节说明，参见 "),a("a",{attrs:{href:"https://github.com/fknop/hapi-pagination/tree/v1.6.5",target:"_blank",rel:"noopener noreferrer"}},[t._v("hapi-pagination"),a("OutboundLink")],1),t._v("。")])]),t._v(" "),t._m(61),t._m(62),t._v(" "),t._m(63),t._v(" "),t._m(64),t._m(65),t._v(" "),t._m(66),t._m(67),t._v(" "),t._m(68),a("p",[t._v("其中 JWT 的规范有一套预设的标准注册声明，非必要项，在业务场景需要的时候加入：")]),t._v(" "),t._m(69),t._v(" "),t._m(70),t._v(" "),t._m(71),t._v(" "),t._m(72),a("p",[a("code",[t._v("Secret")]),t._v(" 的秘钥签发，可以通过一些在线的 AES 加密工具来生成一串长度 32 或 64 的随机字符串。比如： "),a("a",{attrs:{href:"http://tool.oschina.net/encrypt/",target:"_blank",rel:"noopener noreferrer"}},[t._v("tool.oschina.net/encrypt/"),a("OutboundLink")],1),t._v(" 。太长的字符串会一定程度上影响 jwt 验证的计算效率，所以找寻一个平衡点为宜。")]),t._v(" "),t._m(73),t._v(" "),t._m(74),t._v(" "),t._m(75),t._v(" "),t._m(76),t._v(" "),t._m(77),t._v(" "),t._m(78),t._v(" "),t._m(79),t._m(80),t._v(" "),a("ul",[t._m(81),t._v(" "),a("li",[t._v("可以通过 "),a("a",{attrs:{href:"https://jwt.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("JWT"),a("OutboundLink")],1),t._v(" 来 decode JWT 中的 payload 信息。")])]),t._v(" "),t._m(82),t._v(" "),t._m(83),t._v(" "),t._m(84),t._m(85),t._v(" "),t._m(86),t._m(87),t._v(" "),t._m(88),t._v(" "),a("blockquote",[a("p",[a("em",[t._v("在一个事务中，可能会包含开始（start）、提交（commit）、回滚（rollback）等操作，Sequelize 通过 "),a("a",{attrs:{href:"http://docs.sequelizejs.com/manual/tutorial/transactions.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Transaction"),a("OutboundLink")],1),t._v("类来实现事务相关功能。以满足一些对操作过程的完整性比较高的使用场景。")]),t._v(" "),a("em",[t._v("托管事务基于 Promise 结果链进行自动提交或回滚。非托管事务则交由用户自行控制提交或回滚。")])])]),t._v(" "),t._m(89),t._v(" "),t._m(90),t._m(91),t._v(" "),t._m(92),t._v(" "),t._m(93),t._m(94),t._v(" "),t._m(95),t._v(" "),t._m(96),t._v(" "),t._m(97),t._v(" "),t._m(98),t._v(" "),t._m(99),t._v(" "),t._m(100),t._v(" "),t._m(101),t._m(102),t._v(" "),t._m(103),t._v(" "),a("p",[t._v("Sentry 中文翻译过来是哨兵的意思，从字面中可以知道 「站岗、放哨、巡逻、稽查的士兵」，不错，Sentry 是程序的「哨兵」 。它可以监控我们在生产环境中项目的运行状态，一旦某段代码运行报错，或者异常，会第一时间把报错的 路由，异常文件，请求方式 等一些非常详细的信息以消息或者邮件给我们，让我们第一时间知道：程序出错了，然后我们可以从 Sentry 给我们的详细的错误信息中瞬间找到我们需要处理的代码，并及时修正。")]),t._v(" "),t._m(104),t._v(" "),a("p",[t._v("利用 hapi 的 API 服务能力再搭建一个简易的内网 API 服务，该服务使用 Sentry 的 raven 插件进行错误日志的收集与汇报，日志的信息源来自应用服务的 good-http 插件")]),t._v(" "),t._m(105),t._v(" "),t._m(106),t._m(107),t._m(108),t._v(" "),t._m(109),t._m(110),t._v(" "),t._m(111)])},[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"hapi"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hapi","aria-hidden":"true"}},[this._v("#")]),this._v(" Hapi")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"hapi-相关使用总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hapi-相关使用总结","aria-hidden":"true"}},[this._v("#")]),this._v(" Hapi 相关使用总结")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("Hapi.js 是一个用来构建基于 Node.js 的应用和服务的富框架，使得开发者把重点放在便携可重用的应用逻辑而不是构建架构。内建输入验证、缓存、认证和其他 Web 应用开发常用的功能。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"hapi-框架模块接口文档"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hapi-框架模块接口文档","aria-hidden":"true"}},[this._v("#")]),this._v(" Hapi 框架模块接口文档")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"supervisor-nodemon-pm2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#supervisor-nodemon-pm2","aria-hidden":"true"}},[this._v("#")]),this._v(" Supervisor / nodemon / PM2")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("有不少 Node.js 小工具能帮助我们监视代码的改动然后自动重启 Node.js 服务，好用的工具有 "),s("code",[this._v("Supervisor / nodemon / PM2")]),this._v("。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{attrs:{class:"token comment"}},[this._v("# 系统全局安装 supervisor")]),this._v("\n$ "),s("span",{attrs:{class:"token function"}},[this._v("npm")]),this._v(" i -g supervisor\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"目录结构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#目录结构","aria-hidden":"true"}},[this._v("#")]),this._v(" 目录结构")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("├── config                       # 项目配置目录\n|   ├── index.js                 # 配置项目中的配置信息\n├── models                       # 数据库 model\n├── node_modules                 # node.js 的依赖目录\n├── plugins                      # 插件目录\n├── routes                       # 路由目录\n│   ├── hello-world.js           # 测试接口 hello-world\n├── utils                        # 工具类相关目录\n├── app.js                       # 项目入口文件\n├── package.json                 # JS 项目工程依赖库\n├── README.md                    # 项目工程如何被使用的说明手册\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"环境配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#环境配置","aria-hidden":"true"}},[this._v("#")]),this._v(" 环境配置")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("例子：")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("# .env.example")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("# 服务的启动名字和端口，但也可以缺省不填值，默认值的填写只是一定程度减少起始数据配置工作")]),t._v("\nHOST "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" 127.0.0.1\nPORT "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" 3000\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"读取-env-中的配置值"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#读取-env-中的配置值","aria-hidden":"true"}},[this._v("#")]),this._v(" 读取 .env 中的配置值")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("Node.js 可以通过 env2 的插件，来读取 .env 配置文件，加载后的环境配置参数，可以通过例如 process.env.PORT 来读取端口信息。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{attrs:{class:"token function"}},[this._v("npm")]),this._v(" i env2 -D\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"使用-swagger-插件配置接口文档"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用-swagger-插件配置接口文档","aria-hidden":"true"}},[this._v("#")]),this._v(" 使用 Swagger 插件配置接口文档")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"安装基础依赖与基础插件配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装基础依赖与基础插件配置","aria-hidden":"true"}},[this._v("#")]),this._v(" 安装基础依赖与基础插件配置")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("# 安装适配 hapi v16 的 swagger 插件")]),t._v("\n"),a("span",{attrs:{class:"token function"}},[t._v("npm")]),t._v(" i hapi-swagger@7\n"),a("span",{attrs:{class:"token function"}},[t._v("npm")]),t._v(" i inert@4\n"),a("span",{attrs:{class:"token function"}},[t._v("npm")]),t._v(" i vision@4\n"),a("span",{attrs:{class:"token function"}},[t._v("npm")]),t._v(" i package\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("├── plugins                       # hapi 插件配置\n|   ├── hapi-swagger.js           # swagger 插件\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("通过 "),s("strong",[this._v("自己的服务地址+/documentation")]),this._v(" 来查看 Swagger 文档。"),s("em",[this._v("http://192.168.31.10:8181/documentation")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"使用-joi-校验数据结构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用-joi-校验数据结构","aria-hidden":"true"}},[this._v("#")]),this._v(" 使用 Joi 校验数据结构")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{attrs:{class:"token comment"}},[this._v("# 安装适配 hapi v16 的 joi 插件")]),this._v("\n"),s("span",{attrs:{class:"token function"}},[this._v("npm")]),this._v(" i joi@13\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"mysql修改默认编码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mysql修改默认编码","aria-hidden":"true"}},[this._v("#")]),this._v(" MySQL修改默认编码")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[s("code",[this._v("show variables like '%char%';")]),this._v(" 查看默认编码")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("mysql"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" show variables like "),a("span",{attrs:{class:"token string"}},[t._v("'%char%'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n+--------------------------+---------------------------------------------------------+\n"),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" Variable_name            "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" Value                                                   "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("\n+--------------------------+---------------------------------------------------------+\n"),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" character_set_client     "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" gbk                                                     "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" character_set_connection "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" gbk                                                     "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" character_set_database   "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" utf8                                                    "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" character_set_filesystem "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" binary                                                  "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" character_set_results    "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" gbk                                                     "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" character_set_server     "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" utf8                                                    "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" character_set_system     "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" utf8                                                    "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" character_sets_dir       "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" C:\\Program Files\\MySQL\\MySQL Server 5.7\\share\\charsets\\ "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("\n+--------------------------+---------------------------------------------------------+\n8 rows "),a("span",{attrs:{class:"token keyword"}},[t._v("in")]),t._v(" set, 1 warning "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0.00 sec"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[s("p",[this._v("修改mysql编码，（version：5.7.24）Window10下 "),s("code",[this._v("my.ini")]),this._v("文件路径在 "),s("code",[this._v("C:\\ProgramData\\MySQL\\MySQL Server 5.7\\")])])]),this._v(" "),s("li",[s("p",[this._v("在my.ini添加如下：")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-ini extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[a("span",{attrs:{class:"token selector"}},[t._v("[mysqld]")]),t._v("\n"),a("span",{attrs:{class:"token constant"}},[t._v("character-set-server")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("=")]),t._v("utf8")]),t._v("\n"),a("span",{attrs:{class:"token selector"}},[t._v("[client]")]),t._v("\n"),a("span",{attrs:{class:"token constant"}},[t._v("default-character-set")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("=")]),t._v("utf8")]),t._v("\n"),a("span",{attrs:{class:"token selector"}},[t._v("[mysql]")]),t._v("\n"),a("span",{attrs:{class:"token constant"}},[t._v("default-character-set")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("=")]),t._v("utf8")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"mysql-与-sequelize"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mysql-与-sequelize","aria-hidden":"true"}},[this._v("#")]),this._v(" MySQL 与 Sequelize")])},function(){var t=this.$createElement,s=this._self._c||t;return s("li",[this._v("Sequelize 支持的数据库有："),s("code",[this._v("PostgreSQL，MySQL，MariaDB，SQLite 和 MSSQL。")]),this._v("在使用不同的数据库时候，需要我们开发者额外安装不同的对应数据库连接驱动，d当前使用的 MySQL，则依赖于插件 MySQL2 。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("# MySQL 连接")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@vultr ~"),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token comment"}},[t._v("# mysql -u root -p")]),t._v("\nEnter password: *******\n\nWelcome to the MySQL monitor.  Commands end with "),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" or \\g.\nYour MySQL connection "),a("span",{attrs:{class:"token function"}},[t._v("id")]),t._v(" is 3\nServer version: 5.7.22 MySQL Community Server "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("GPL"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nCopyright "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("c"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" 2000, 2018, Oracle and/or its affiliates. All rights reserved.\n\nOracle is a registered trademark of Oracle Corporation and/or its\naffiliates. Other names may be trademarks of their respective\nowners.\n\nType "),a("span",{attrs:{class:"token string"}},[t._v("'help;'")]),t._v(" or "),a("span",{attrs:{class:"token string"}},[t._v("'\\h'")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("for")]),t._v(" help. Type "),a("span",{attrs:{class:"token string"}},[t._v("'\\c'")]),t._v(" to "),a("span",{attrs:{class:"token function"}},[t._v("clear")]),t._v(" the current input statement.\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("# 查看数据库编码格式")]),t._v("\nmysql"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" show variables like "),a("span",{attrs:{class:"token string"}},[t._v("'%char%'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n+--------------------------+---------------------------------------------------------+\n"),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" Variable_name            "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" Value                                                   "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("\n+--------------------------+---------------------------------------------------------+\n"),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" character_set_client     "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" utf8                                                    "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" character_set_connection "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" utf8                                                    "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" character_set_database   "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" latin1                                                  "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" character_set_filesystem "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" binary                                                  "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" character_set_results    "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" utf8                                                    "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" character_set_server     "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" latin1                                                  "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" character_set_system     "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" utf8                                                    "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" character_sets_dir       "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" C:\\Program Files\\MySQL\\MySQL Server 5.7\\share\\charsets\\ "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("\n+--------------------------+---------------------------------------------------------+\n8 rows "),a("span",{attrs:{class:"token keyword"}},[t._v("in")]),t._v(" set, 1 warning "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0.00 sec"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("# 创建用户")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("# 说明：")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("# username：你将创建的用户名")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("# host：指定该用户在哪个主机上可以登陆，如果是本地用户可用localhost，如果想让该用户可以从任意远程主机登陆，可以使用通配符%")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("# password：该用户的登陆密码，密码可以为空，如果为空则该用户可以不需要密码登陆服务器")]),t._v("\nmysql"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" CREATE USER "),a("span",{attrs:{class:"token string"}},[t._v("'username'")]),t._v("@"),a("span",{attrs:{class:"token string"}},[t._v("'host'")]),t._v(" IDENTIFIED BY "),a("span",{attrs:{class:"token string"}},[t._v("'password'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("# 授权")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("# 说明:")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("# privileges：用户的操作权限，如SELECT，INSERT，UPDATE等，如果要授予所的权限则使用ALL")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("# databasename：数据库名")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("# tablename：表名，如果要授予该用户对所有数据库和表的相应操作权限则可用*表示，如*.*")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("# 例子：")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("# GRANT SELECT, INSERT ON test.user TO 'pig'@'%';")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("# GRANT ALL ON *.* TO 'pig'@'%';")]),t._v("\nmysql"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" GRANT privileges ON databasename.tablename TO "),a("span",{attrs:{class:"token string"}},[t._v("'username'")]),t._v("@"),a("span",{attrs:{class:"token string"}},[t._v("'host'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("# 注意:用以上命令授权的用户不能给其它用户授权，如果想让该用户可以授权，用以下命令:")]),t._v("\nmysql"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" GRANT privileges ON databasename.tablename TO "),a("span",{attrs:{class:"token string"}},[t._v("'username'")]),t._v("@"),a("span",{attrs:{class:"token string"}},[t._v("'host'")]),t._v(" WITH GRANT OPTION"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("# 设置与更改用户密码")]),t._v("\nmysql"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" SET PASSWORD FOR "),a("span",{attrs:{class:"token string"}},[t._v("'username'")]),t._v("@"),a("span",{attrs:{class:"token string"}},[t._v("'host'")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" PASSWORD"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'newpassword'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("# 如果是当前登陆用户用:")]),t._v("\nmysql"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" SET PASSWORD "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" PASSWORD"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"newpassword"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("# 撤销用户权限")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("# 说明：说明:privilege, databasename, tablename：同授权部分")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("# 注意：")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("# 假如你在给用户'pig'@'%'授权的时候是这样的（或类似的）：GRANT SELECT ON test.user TO 'pig'@'%'，则在使用REVOKE SELECT ON *.* FROM 'pig'@'%';命令并不能撤销该用户对test数据库中user表的SELECT 操作。相反，如果授权使用的是GRANT SELECT ON *.* TO 'pig'@'%';则REVOKE SELECT ON test.user FROM 'pig'@'%';命令也不能撤销该用户对test数据库中user表的Select权限。")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("# 具体信息可以用命令SHOW GRANTS FOR 'pig'@'%'; 查看")]),t._v("\nmysql"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" REVOKE privilege ON databasename.tablename FROM "),a("span",{attrs:{class:"token string"}},[t._v("'username'")]),t._v("@"),a("span",{attrs:{class:"token string"}},[t._v("'host'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("# 删除用户")]),t._v("\nmysql"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" DROP USER "),a("span",{attrs:{class:"token string"}},[t._v("'username'")]),t._v("@"),a("span",{attrs:{class:"token string"}},[t._v("'host'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"sequelize-cli"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sequelize-cli","aria-hidden":"true"}},[this._v("#")]),this._v(" Sequelize-cli")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[s("p",[this._v("Sequelize 插件的主要应用场景是实际应用开发过程中的代码逻辑层。与其相伴的还有一套 cli 工具，Sequelize-cli，提供了一系列好用的终端指令，来帮助我们完成一些常用的琐碎任务。")])]),this._v(" "),s("li",[s("p",[this._v("安装依赖")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{attrs:{class:"token function"}},[this._v("npm")]),this._v(" i sequelize-cli -D\n"),s("span",{attrs:{class:"token function"}},[this._v("npm")]),this._v(" i sequelize\n"),s("span",{attrs:{class:"token function"}},[this._v("npm")]),this._v(" i mysql2\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("sequelize init (通过 sequelize-cli 初始化 sequelize，我们将得到一个好用的初始化结构：)")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{attrs:{class:"token comment"}},[this._v("# windows下")]),this._v("\nnode_modules\\.bin\\sequelize init\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("├── config                       # 项目配置目录\n|   ├── config.[json|js]              # 数据库连接的配置\n├── models                       # 数据库 model\n|   ├── index.js                 # 数据库连接的样板代码\n├── migrations                   # 数据迁移的目录\n├── seeders                      # 数据填充的目录\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("sequelize db:create")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("node_modules\\.bin\\sequelize db:create\n\n"),s("span",{attrs:{class:"token comment"}},[this._v("# 通过 --env 参数，指定为生产环境创建项目数据库")]),this._v("\n"),s("span",{attrs:{class:"token comment"}},[this._v("# node_modules\\.bin\\sequelize db:create --env production")]),this._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"migrate-数据迁移"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#migrate-数据迁移","aria-hidden":"true"}},[this._v("#")]),this._v(" migrate 数据迁移")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("sequelize migration:create "),s("em",[this._v("使用 sequelize migration:create 来创建一个迁移文件 create-shops-table。")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("node_modules\\.bin\\sequelize migration:create --name create-shops-table\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("sequelize db:migrate "),s("em",[this._v("帮助将 migrations 目录下的迁移行为定义，按时间戳的顺序，逐个地执行迁移描述，最终完成数据库表结构的自动化创建。并且，在数据库中会默认创建一个名为 SequelizeMeta 的表，用于记录在当前数据库上所运行的迁移历史版本。")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("node_modules\\.bin\\sequelize db:migrate\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("mysql"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" show tables"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n+---------------------+\n"),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" Tables_in_practtest "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("\n+---------------------+\n"),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" goods               "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" sequelizemeta       "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" shops               "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("\n+---------------------+\n3 rows "),a("span",{attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("set")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0.00 sec"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[s("p",[this._v("sequelize db:migrate:undo "),s("em",[this._v("sequelize db:migrate:undo 则可以帮助我们按照 down 方法中所定义的规则，回退一个数据库表结构迁移的状态。"),s("code",[this._v("node_modules\\.bin\\sequelize db:migrate:undo")])])])]),this._v(" "),s("li",[s("p",[this._v("向表中追加字段 "),s("em",[this._v("创建一个名叫 add-columns-to-shops-table 的迁移迁移文件："),s("code",[this._v("node_modules\\.bin\\sequelize migration:create --name add-columns-to-shops-table")])])])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("module"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  up"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("queryInterface"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Sequelize"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" Promise"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("all")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    queryInterface"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("addColumn")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'shops'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'address'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" type"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Sequelize"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token constant"}},[t._v("STRING")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n  down"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" queryInterface "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" Promise"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("all")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    queryInterface"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("removeColumn")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'shops'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'address'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("# 之前的表结构")]),t._v("\nmysql"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" desc shops"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n+------------+--------------+------+-----+---------+----------------+\n"),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" Field      "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" Type         "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" Null "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" Key "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" Default "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" Extra          "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("\n+------------+--------------+------+-----+---------+----------------+\n"),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("id")]),t._v("         "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" int"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("11"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("      "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" NO   "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" PRI "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" NULL    "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" auto_increment "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" name       "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" varchar"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("255"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" NO   "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("     "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" NULL    "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("                "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" thumb_url  "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" varchar"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("255"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" YES  "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("     "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" NULL    "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("                "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" created_at "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" datetime     "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" YES  "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("     "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" NULL    "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("                "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" updated_at "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" datetime     "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" YES  "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("     "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" NULL    "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("                "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("\n+------------+--------------+------+-----+---------+----------------+\n5 rows "),a("span",{attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("set")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0.00 sec"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("# 再次运行完 node_modules\\.bin\\sequelize db:migrate 后的表结构")]),t._v("\nmysql"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" desc shops"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n+------------+--------------+------+-----+---------+----------------+\n"),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" Field      "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" Type         "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" Null "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" Key "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" Default "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" Extra          "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("\n+------------+--------------+------+-----+---------+----------------+\n"),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("id")]),t._v("         "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" int"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("11"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("      "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" NO   "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" PRI "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" NULL    "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" auto_increment "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" name       "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" varchar"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("255"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" NO   "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("     "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" NULL    "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("                "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" thumb_url  "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" varchar"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("255"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" YES  "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("     "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" NULL    "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("                "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" created_at "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" datetime     "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" YES  "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("     "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" NULL    "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("                "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" updated_at "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" datetime     "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" YES  "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("     "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" NULL    "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("                "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" address    "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" varchar"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("255"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" YES  "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("     "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" NULL    "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("                "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("\n+------------+--------------+------+-----+---------+----------------+\n6 rows "),a("span",{attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("set")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0.00 sec"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"seeders-种子数据填充"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#seeders-种子数据填充","aria-hidden":"true"}},[this._v("#")]),this._v(" seeders 种子数据填充")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[a("p",[t._v("sequelize seed:create "),a("em",[a("code",[t._v("node_modules\\.bin\\sequelize seed:create --name init-shops")])])])]),t._v(" "),a("li",[a("p",[t._v("sequelize db:seed:all "),a("em",[t._v("与 db:migrate 相似，执行 sequelize db:seed:all ，将向数据库填充 seeders 目录中所有 up 方法所定义的数据。"),a("code",[t._v("node_modules\\.bin\\sequelize db:seed:all")])]),a("strong",[t._v("注意: seeders 的执行，不会将状态存储在 SequelizeMeta 表中。")]),t._v("(当然，我们也可以通过 "),a("code",[t._v("--seed")]),t._v(" 来制定特定的 "),a("code",[t._v("seed")]),t._v(" 配置来做填充：\n"),a("code",[t._v("node_modules\\.bin\\sequelize db:seed --seed 20190103082032-init-goods.js")]),t._v(")")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("# 添加后的数据表")]),t._v("\nmysql"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("select")]),t._v(" * from shops"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n+----+-------+-----------+---------------------+---------------------+---------+\n"),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("id")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" name  "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" thumb_url "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" created_at          "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" updated_at          "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" address "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("\n+----+-------+-----------+---------------------+---------------------+---------+\n"),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("  1 "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" 店铺1 "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" 1.png     "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" 2018-12-30 12:10:22 "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" 2018-12-30 12:10:22 "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" NULL    "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("  2 "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" 店铺2 "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" 2.png     "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" 2018-12-30 12:10:22 "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" 2018-12-30 12:10:22 "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" NULL    "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("  3 "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" 店铺3 "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" 3.png     "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" 2018-12-30 12:10:22 "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" 2018-12-30 12:10:22 "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" NULL    "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("  4 "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" 店铺4 "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" 4.png     "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" 2018-12-30 12:10:22 "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" 2018-12-30 12:10:22 "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" NULL    "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("  5 "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" 店铺5 "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" 5.png     "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" 2018-12-30 12:10:22 "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" 2018-12-30 12:10:22 "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" NULL    "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("\n+----+-------+-----------+---------------------+---------------------+---------+\n5 rows "),a("span",{attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("set")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0.00 sec"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("sequelize db:seed:undo "),s("em",[this._v("Seeders 所填充的数据，也与迁移的 db:migrate:undo 相仿，只是不会进入 SequelizeMeta 记录。两个可用的命令如下，很简单，不再赘述：")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("# 撤销所有的种子")]),t._v("\nnode_modules\\.bin\\sequelize db:seed:undo:all\n"),a("span",{attrs:{class:"token comment"}},[t._v("# 数据表")]),t._v("\nmysql"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("select")]),t._v(" * from shops"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n+----+-------+-----------+---------------------+---------------------+---------+\n"),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("id")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" name  "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" thumb_url "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" created_at          "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" updated_at          "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" address "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("\n+----+-------+-----------+---------------------+---------------------+---------+\n"),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("  5 "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" 店铺5 "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" 5.png     "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" 2018-12-30 12:10:22 "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" 2018-12-30 12:10:22 "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" NULL    "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("\n+----+-------+-----------+---------------------+---------------------+---------+\n1 row "),a("span",{attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("set")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0.00 sec"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("# 撤销指定的种子")]),t._v("\nnode_modules\\.bin\\sequelize db:seed:undo --seed XXXXXXXXXXXXXX-demo-user.js\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"sequelize-连接-mysql-数据库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sequelize-连接-mysql-数据库","aria-hidden":"true"}},[this._v("#")]),this._v(" Sequelize 连接 MySQL 数据库")])},function(){var t=this.$createElement,s=this._self._c||t;return s("strong",[this._v("希望遵循 MySQL 数据库表字段的下划线命名规范，所以，需要全局开启一个 "),s("code",[this._v("underscore: true")]),this._v(" 的定义，来使系统中默认的 createdAt 与 updatedAt 能以下划线的方式，与表结构保持一致。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"定义数据库业务相关的-model"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#定义数据库业务相关的-model","aria-hidden":"true"}},[this._v("#")]),this._v(" 定义数据库业务相关的 model")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("结合业务所需，可以在存放 models 目录下继续创建一系列的 model 来与数据库表结构做对应：")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("├── models                       # 数据库 model\n│   ├── index.js                 # model 入口与连接\n│   ├── goods.js                 # 商品表\n│   ├── shops.js                 # 店铺表\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"实现接口"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实现接口","aria-hidden":"true"}},[this._v("#")]),this._v(" 实现接口")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[t._v("很多时候，我们并不希望 findAll 来将数据表中的所有数据全都暴露出来，比如在查询用户列表时，用户的密码的值，便是特别敏感的数据。 我们可以在 findAll 中加入一个 "),a("code",[t._v("attributes")]),t._v(" 的约束，可以是一个要查询的属性（字段）列表，或者是一个 key 为 "),a("code",[t._v("include")]),t._v(" 或 "),a("code",[t._v("exclude")]),t._v(" 对象的键，比如对于用户表，"),a("code",[t._v("findAll({ attributes: { exclude: ['password'] } })")]),t._v("，就可以排除密码字段的查询露出。")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Joi "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("require")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'joi'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" models "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("require")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'../models'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("GROUP_NAME")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'shops'")]),t._v("\n\nmodule"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    method"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'GET'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    path"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token template-string"}},[a("span",{attrs:{class:"token string"}},[t._v("`/")]),a("span",{attrs:{class:"token interpolation"}},[a("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),a("span",{attrs:{class:"token constant"}},[t._v("GROUP_NAME")]),a("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{attrs:{class:"token string"}},[t._v("`")])]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    handler"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" reply"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{attrs:{class:"token comment"}},[t._v("// 查找数据")]),t._v("\n      "),a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" result "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("await")]),t._v(" models"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shops"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("findAll")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{attrs:{class:"token comment"}},[t._v("// 只返回 id 和 name")]),t._v("\n        attributes"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token string"}},[t._v("'id'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'name'")]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n      "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),a("span",{attrs:{class:"token function"}},[t._v("reply")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("result"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    config"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      tags"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token string"}},[t._v("'api'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("GROUP_NAME")]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      description"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'获取店铺列表'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{attrs:{class:"token comment"}},[t._v("// 适用于 GET 接口的 query（URL 路径参数）")]),t._v("\n      validate"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        query"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          limit"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Joi"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("number")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("integer")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("min")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("default")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("10")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("description")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'每页条数'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          "),a("span",{attrs:{class:"token comment"}},[t._v("// error(new Error('页码数不能为0！'))  显示的错误信息为中文（message）")]),t._v("\n          page"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Joi"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("number")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("integer")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("min")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("default")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("description")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'页码数'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("error")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("Error")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'页码数不能为0！'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token operator"}},[t._v("...")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{attrs:{class:"token comment"}},[this._v("# 安装适配 hapi v16 的 hapi-pagination")]),this._v("\n$ "),s("span",{attrs:{class:"token function"}},[this._v("npm")]),this._v(" i hapi-pagination@1\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"基于-jwt-的身份验证"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基于-jwt-的身份验证","aria-hidden":"true"}},[this._v("#")]),this._v(" 基于 JWT 的身份验证")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("JWT 全称 JSON Web Token，是为了方便在各系统之间安全地传送 JSON 对象格式的信息，而采用的一个开发标准，基于 RFC 7519 定义。服务器在接收到 JWT 之后，可以验证它的合法性，用户登录与否的身份验证便是 JWT 的使用场景之一。")]),this._v(" "),s("li",[this._v("JWT 具有「紧凑」与「自包含」的两大特点: 紧凑（compact）、自包含（self-contained）")]),this._v(" "),s("li",[this._v("JWT 的构成---JSON Web Token 由 header、payload、signature 三部分组成，使用点号 . 分隔，下面是一段典型的 JWT 串:")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{attrs:{class:"token comment"}},[this._v("# header")]),this._v("\neyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.\n"),s("span",{attrs:{class:"token comment"}},[this._v("# payload")]),this._v("\neyJ1c2VySWQiOjEsImV4cCI6MTUzNTMyMjc0NSwiaWF0IjoxNTM0NzE3OTQ1fQ.\n"),s("span",{attrs:{class:"token comment"}},[this._v("# signature")]),this._v("\n6tOdn2R82bxJbXjAnwU5g4g9EKqGNe-qo4qCo6UZnQ\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("header -- JWT 第一部分 header 指定了该 JWT 使用的签名算法：")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{attrs:{class:"token property"}},[t._v('"alg"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"HS256"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token property"}},[t._v('"typ"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),a("span",{attrs:{class:"token string"}},[t._v('"JWT"')]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[t._v("payload -- JWT 的第二部分 "),a("code",[t._v("payload")]),t._v(" 包含了该 JWT 的签发内容信息。以如上述 JWT 串为例，被解码之后，可以得到如下信息，包涵有用户 "),a("code",[t._v("ID")]),t._v("，"),a("code",[t._v("JWT")]),t._v(" 过期时间 "),a("code",[t._v("exp")]),t._v("，"),a("code",[t._v("JWT")]),t._v(" 签发时间 "),a("code",[t._v("iat")]),t._v("。")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token property"}},[t._v('"userId"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token property"}},[t._v('"exp"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("1535322745")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token property"}},[t._v('"iat"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("1534717945")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("blockquote",[a("ul",[a("li",[a("code",[t._v("iss(issuer)")]),t._v("：JWT 的签发者")]),t._v(" "),a("li",[a("code",[t._v("sub(subject)")]),t._v("：JWT 所面向的用户")]),t._v(" "),a("li",[a("code",[t._v("aud(audience)")]),t._v("：接收 JWT 的一方")]),t._v(" "),a("li",[a("code",[t._v("exp(expiresIn)")]),t._v("：JWT 的过期时间，这个时间必须大于签发时间")]),t._v(" "),a("li",[a("code",[t._v("nbf(notBefore)")]),t._v("：定义在什么时间之前，该 JWT 都是不可用的")]),t._v(" "),a("li",[a("code",[t._v("iat(issuedAt)")]),t._v("：JWT 的签发时间")]),t._v(" "),a("li",[a("code",[t._v("jti(jwtid)")]),t._v("：JWT 的唯一身份标识，主要用来作为一次性 token，从而避免重放攻击")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("其他的信息数据，可以在 payload 中额外追加，避免与预设保留字冲突就好。"),s("br"),this._v(" "),s("em",[this._v("注意")]),this._v(" ：对于已签发的 JWT, 尽管信息是可以受到下文 signature 的签名防篡改保护，但 payload 部分的内容，依旧任何人都可以 decode 解码阅读。故而不要在 payload 中存放诸如密码密秘类的安全敏感数据。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("signature -- JWT 的第三部分 signature 用来验证签发数据的合法性，是否存在第三方篡改伪造行为。由 header + payload + 签发 secret 组合而成。有心的读者可以发现，其中的参数条件 header 和 payload 皆为 base64 的编码内容，base64 是一种可双向的编码算法，所以不具备数据安全性。唯有 secret 的参数条件，在 JWT 最终的生成串中并不公开，所以在服务端保管好 secret 的签发字符串的私密性尤为重要，随意地将其提交进 git 的代码版本库，是一种极度不严谨行为。 以 HS256 算法为例，signature 的签发算法如下：")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token constant"}},[t._v("HMACSHA256")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token function"}},[t._v("base64UrlEncode")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("header"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"."')]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("base64UrlEncode")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("payload"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" secret"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"基于-jwt-的身份验证的好处"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基于-jwt-的身份验证的好处","aria-hidden":"true"}},[this._v("#")]),this._v(" 基于 JWT 的身份验证的好处")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[a("strong",[t._v("跨语言性")]),t._v("：payload 数据结构基于 JSON，可以被任何主流语言支持。")]),t._v(" "),a("li",[a("strong",[t._v("免疫 CSRF")]),t._v("：对 Cookie 的不依赖性，决定了天然免疫 CSRF 攻击。")]),t._v(" "),a("li",[a("strong",[t._v("可跨域性")]),t._v("：同样是对 Cookie 的不依赖性，决定了更好的跨域支持与独立服务化属性。")]),t._v(" "),a("li",[a("strong",[t._v("多端适配")]),t._v("：iOS， Android，微信小程序等非网页客户端，Cookie 是不被支持的，JWT 的认证机制则会简单很多。")]),t._v(" "),a("li",[a("strong",[t._v("去耦可扩展性")]),t._v("：JWT 可以在任何拥有正确 secret 私钥的 API 服务环境被身份验证和使用，便于微服务拆分。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"基于-jwt-身份验证的注意项"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基于-jwt-身份验证的注意项","aria-hidden":"true"}},[this._v("#")]),this._v(" 基于 JWT 身份验证的注意项")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("不要在 JWT 的 payload 中签入敏感信息")]),this._v(" "),s("li",[this._v("保护好 secret 秘钥")]),this._v(" "),s("li",[this._v("使用 HTTPS 传输 JWT")]),this._v(" "),s("li",[this._v("设置较短的 JWT 失效时间，并结合一个失效较长的 JWT RefreshToken 组合为宜。因为 JWT 无法轻易失效已签发的合法 JWT")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"使用-jsonwebtoken-签发-jwt"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用-jsonwebtoken-签发-jwt","aria-hidden":"true"}},[this._v("#")]),this._v(" 使用 jsonwebtoken 签发 JWT")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("jsonwebtoken 是 Node.js 生态里用于签发与校验 JWT 的流行插件。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{attrs:{class:"token function"}},[this._v("npm")]),this._v(" i jsonwebtoken\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h5",{attrs:{id:"jwt-sign-签发"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jwt-sign-签发","aria-hidden":"true"}},[this._v("#")]),this._v(" jwt.sign 签发")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("li",[t._v("JWT 的签发语法是 "),a("code",[t._v("jwt.sign(payload, secretOrPrivateKey, [options, callback])")]),t._v("。默认的签发算法基于 "),a("code",[t._v("HS256 (HMAC SHA256)")]),t._v("，可以在 options 参数的 "),a("code",[t._v("algorithm")]),t._v(" 另行修改。JWT 签发规范中的一些标准保留字段比如 "),a("code",[t._v("exp")]),t._v("，"),a("code",[t._v("nbf")]),t._v("，"),a("code",[t._v("aud")]),t._v("，"),a("code",[t._v("sub")]),t._v("，"),a("code",[t._v("iss")]),t._v(" 等都没有默认值，可以一并在 "),a("code",[t._v("payload")]),t._v("参数中按需声明使用，亦可以在第三个参数 options 中，通过 "),a("code",[t._v("expiresIn")]),t._v("，"),a("code",[t._v("notBefore")]),t._v("，"),a("code",[t._v("audience")]),t._v("，"),a("code",[t._v("subject")]),t._v("，"),a("code",[t._v("issuer")]),t._v(" 来分别赋值，但是不允许在两处同时声明。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h5",{attrs:{id:"hapi-auth-jwt2-接口用户验证"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hapi-auth-jwt2-接口用户验证","aria-hidden":"true"}},[this._v("#")]),this._v(" hapi-auth-jwt2 接口用户验证")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("安装")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{attrs:{class:"token function"}},[this._v("npm")]),this._v(" i hapi-auth-jwt2@7\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("hapi-auth-jwt2 配置")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("├── plugins                       # hapi 插件配置\n│ ├── hapi-auth-jwt2.js           # jwt 配置插件\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"sequelize-支持两种使用事务的方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sequelize-支持两种使用事务的方法","aria-hidden":"true"}},[this._v("#")]),this._v(" Sequelize 支持两种使用事务的方法")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("托管事务")]),this._v(" "),s("li",[this._v("非托管事务")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"微信接收的数据与返回的格式都是以-text-xml-的格式，而非-application-json-，需要引入-xml2js-的插件帮助在-javascript-的-ojbect-与-xml-的-object-数据关系之间快速转换"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#微信接收的数据与返回的格式都是以-text-xml-的格式，而非-application-json-，需要引入-xml2js-的插件帮助在-javascript-的-ojbect-与-xml-的-object-数据关系之间快速转换","aria-hidden":"true"}},[this._v("#")]),this._v(" 微信接收的数据与返回的格式都是以 text/xml 的格式，而非 application/json ，需要引入 xml2js 的插件帮助在 JavaScript 的 Ojbect 与 XML 的 Object 数据关系之间快速转换")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{attrs:{class:"token function"}},[this._v("npm")]),this._v(" i xml2js\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"系统监控与记录-——-使用-good-插件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#系统监控与记录-——-使用-good-插件","aria-hidden":"true"}},[this._v("#")]),this._v(" 系统监控与记录 —— 使用 Good 插件")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("Good 是一个 hapi 插件，用于监视和报告来自主机的各种 hapi 服务器事件以及 ops 信息。它侦听 hapi 服务器实例发出的事件，并将标准化事件推送到流集合中。Good 插件目前有这四个扩展功能： good-squeeze、good-console、good-file、good-http。")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{attrs:{class:"token function"}},[t._v("npm")]),t._v(" i good@7\n"),a("span",{attrs:{class:"token function"}},[t._v("npm")]),t._v(" i good-squeeze@5\n"),a("span",{attrs:{class:"token function"}},[t._v("npm")]),t._v(" i good-console@7\n"),a("span",{attrs:{class:"token function"}},[t._v("npm")]),t._v(" i good-file@6\n"),a("span",{attrs:{class:"token function"}},[t._v("npm")]),t._v(" i good-http@6\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("good-squeeze：good-squeeze 是一个小转换流的集合。它提供了两个类，Squeeze 和 SafeJson, Squeeze 流基于良好的事件选项来过滤事件。SafeJson 流用于把对象转成 JSON 字符串，并且可以防止对象中循环引用引起的错误。")]),this._v(" "),s("li",[this._v("good-console：good-console 能够将服务 good 服务事件转化为格式化字符串的转换流插件，最终通过 stdout 在控制台打印输出。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("GoodConsole([config])\ngood-console 本身提供 3 个参数来简单配置控制台的打印信息：")]),this._v(" "),s("ul",[s("li",[this._v("format：使用 MomentJS 格式化时间， 默认值 YYMMDD/HHmmss.SSS")]),this._v(" "),s("li",[this._v("utc：boolean 输出时间是否为布尔值， 默认值 true")]),this._v(" "),s("li",[this._v("color：boolean 是否彩色输出，默认值 true")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("good-file：基于 good-console 的控制台输出日志，当遇到控制台断开或是重启的时候，历史日志将无法找回，此时，在本地生成一份写文件的日志记录，会更好地便于日后的追溯。good-file 插件很好地解决了这样的需求痛点。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("GoodFile (path, options)")]),this._v(" "),s("ul",[s("li",[this._v("path：必填项，用来定义日志的写入目录")]),this._v(" "),s("li",[this._v("options：选填项，文件流的选项。 默认值为"),s("code",[this._v("{ encoding: 'utf8', flags: 'a', mode: 0o666 }")])])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("good-http：除此之外，在实际应用场景中，我们会遇到一些高危异常的错误情况，这类日志我们更希望能在错误发生的第一时间，就通过自动报警的方式，来通知开发人员及时介入响应。这里可以使用 good-http 插件，它可以构造一个 post 的请求接口，将定义的重要日志信息以 JSON 的数据结构方式，推送到目标端点。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("GoodHttp (endpoint, config)")]),this._v(" "),s("ul",[s("li",[this._v("endpoint：日志发送的目标地址")]),this._v(" "),s("li",[this._v("config：Object 类型的配置项目")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("组合使用日志插件：在实际项目使用中，可以进行组合性配置，在 reporters 字段中使用不同的 key 来区分即可")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("reporters"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  typeConsole"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{attrs:{class:"token comment"}},[t._v("// good-console 的一系列配置")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  typeFile"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{attrs:{class:"token comment"}},[t._v("// good-file 的一系列配置")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  typeHttpA"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{attrs:{class:"token comment"}},[t._v("// good-http 针对 A 平台的一系列配置")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  typeHttpB"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{attrs:{class:"token comment"}},[t._v("// good-http 针对 B 平台的一系列配置")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"使用-good-http-结合-sentry-自动收集错误日志"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用-good-http-结合-sentry-自动收集错误日志","aria-hidden":"true"}},[this._v("#")]),this._v(" 使用 good-http 结合 Sentry 自动收集错误日志")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"sentry-简介"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sentry-简介","aria-hidden":"true"}},[this._v("#")]),this._v(" Sentry 简介")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"sentry-服务搭建流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sentry-服务搭建流程","aria-hidden":"true"}},[this._v("#")]),this._v(" Sentry 服务搭建流程")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("申请 Sentry 的 API key")]),this._v(" "),s("li",[this._v("配置 Sentry 的错误收集与报告插件 raven")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{attrs:{class:"token function"}},[this._v("npm")]),this._v(" i raven\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Raven "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("require")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'raven'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nRaven"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("config")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'https://your-sentry-api-key@sentry.io/182062'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("install")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("提供错误日志接收服务")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  method"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'POST'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  path"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'/reportErrorLog'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  handler"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" reply"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token comment"}},[t._v("//直接将请求参数上报到 Sentry")]),t._v("\n    Raven"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("captureException")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("payload"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{attrs:{class:"token function"}},[t._v("reply")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  config"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    tags"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token string"}},[t._v("'api'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'report'")]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    auth"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("false")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("配置应用服务中 good-http 的错误日志推送到上述含有 Sentry raven 的 API 微服务")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("server"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("register")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  plugin"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("require")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'good'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    ops"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      interval"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("1000")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    reporters"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      typeHttp"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          module"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'good-squeeze'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          name"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'Squeeze'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          args"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" error"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'*'")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          module"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'good-http'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          args"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token string"}},[t._v("'http://your-sentry-server/reportErrorLog'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])}],!1,null,null,null);e.options.__file="hapi.md";s.default=e.exports}}]);